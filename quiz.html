<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>JangAfrica Learning Centre — Mathematics Quiz</title>
<style>
  :root{--brand:#0d47a1;--nav:#1565c0}
  body{margin:0;font-family:Arial, sans-serif;background:lightblue;color:#111}
  header{background:var(--brand);color:#fff;padding:18px 10px;text-align:center}
  header h1{font-family:"Arial Black",sans-serif;font-size:36pt;margin:0}
  nav{display:flex;justify-content:center;gap:18px;padding:10px;background:var(--nav)}
  nav button{font-family:Barlow, sans-serif;font-size:16px;color:#fff;background:transparent;border:0;cursor:pointer;padding:8px 12px}
  nav button:hover{text-decoration:underline}
  .wrap{max-width:900px;margin:20px auto;background:#fff;padding:18px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.15)}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  label{display:block;margin:6px 0;font-weight:600}
  input[type=text], input[type=number], select, input[type=time]{width:100%;padding:8px;border-radius:6px;border:1px solid #ccc}
  .col{flex:1;min-width:180px}
  .center{text-align:center}
  button.primary{background:var(--brand);color:#fff;border:0;padding:10px 16px;border-radius:8px;cursor:pointer}
  button.ghost{background:#eee;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
  .hidden{display:none}
  .progress-wrap{background:#eee;border-radius:12px;overflow:hidden;margin:14px 0}
  .progress{height:18px;background:var(--brand);width:0%;color:#fff;text-align:center;font-size:12px;line-height:18px}
  .question-box{margin:12px 0;padding:12px;border-radius:8px;background:#f7faff;border:1px solid #dbeeff}
  .options label{display:block;margin:8px 0;cursor:pointer}
  .small{font-size:13px;color:#555}
  .statbar{display:flex;gap:12px;align-items:center}
  .statbar .pill{background:#f1f1f1;padding:8px 12px;border-radius:20px;font-weight:700}
  footer{margin-top:18px;text-align:center;color:#333;font-size:14px}
  /* modal */
  .modal{display:none;position:fixed;z-index:999;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.5)}
  .modal-content{background:#fff;margin:6% auto;padding:18px;border-radius:10px;max-width:640px;position:relative}
  .close-x{position:absolute;right:12px;top:8px;font-size:22px;cursor:pointer}
  @media(max-width:640px){header h1{font-size:26pt}}
</style>
</head>
<body>

<header>
  <h1>JangAfrica Learning Centre</h1>
</header>

<nav>
  <button onclick="showSection('home')">Home</button>
  <button onclick="showSection('quiz-setup')">Quiz</button>
  <button onclick="openModal('helpModal')">Help</button>
  <button onclick="openModal('aboutModal')">About</button>
</nav>

<div class="wrap" id="mainWrap">
  <!-- HOME -->
  <section id="home">
    <h2 class="center">Welcome</h2>
    <p class="center">This is the JangAfrica Mathematics Quiz system (Kindergarten → Grade 6). Click <strong>Quiz</strong> to start.</p>
  </section>

  <!-- QUIZ SETUP -->
  <section id="quiz-setup" class="hidden">
    <h2 class="center">Quiz Setup</h2>

    <div class="row">
      <div class="col">
        <label for="uName">Name</label>
        <input id="uName" type="text" placeholder="Learner name" />
      </div>
      <div class="col">
        <label for="uGrade">Grade</label>
        <select id="uGrade">
          <option value="">-- Select Grade --</option>
          <option>Kindergarten</option>
          <option>Grade 1</option>
          <option>Grade 2</option>
          <option>Grade 3</option>
          <option>Grade 4</option>
          <option>Grade 5</option>
          <option>Grade 6</option>
        </select>
      </div>
      <div class="col">
        <label for="uAge">Age</label>
        <input id="uAge" type="number" min="3" placeholder="Age" />
      </div>
    </div>

    <div class="row" style="margin-top:10px">
      <div class="col">
        <label for="uSchool">School</label>
        <input id="uSchool" type="text" placeholder="School name" />
      </div>
      <div class="col">
        <label for="numQ">Number of Questions (1–16)</label>
        <input id="numQ" type="number" min="1" max="16" value="16" />
      </div>
      <div class="col">
        <label for="uTime">Time (minutes) — optional</label>
        <input id="uTime" type="number" min="0" placeholder="e.g. 20" />
      </div>
    </div>

    <div style="text-align:center;margin-top:16px">
      <button class="primary" onclick="beginQuiz()">Next: Start Quiz</button>
    </div>
  </section>

  <!-- QUIZ PLAY -->
  <section id="quiz-play" class="hidden">
    <div class="statbar" style="justify-content:space-between">
      <div>
        <strong id="displayGrade">GRADE</strong> — <span id="displayName"></span>
        <div class="small">Question <span id="qIndex">0</span> / <span id="qTotal">0</span></div>
      </div>
      <div style="text-align:right">
        <div class="small">Progress</div>
        <div style="width:260px">
          <div class="progress-wrap"><div id="progress" class="progress">0%</div></div>
        </div>
        <div class="stat-row" style="margin-top:6px">
          <span class="pill">Correct: <span id="displayCorrect">0</span></span>
          <span class="pill">Wrong: <span id="displayWrong">0</span></span>
        </div>
      </div>
    </div>

    <div class="question-box" id="questionBox">
      <!-- question injected here -->
    </div>

    <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:12px">
      <button class="primary" onclick="submitAnswer()">Submit</button>
      <button class="ghost" onclick="finishEarly()">Finish Quiz</button>
    </div>
  </section>

  <!-- RESULTS -->
  <section id="quiz-results" class="hidden">
    <h2 class="center">Quiz Completed</h2>
    <p class="center small">Summary of results</p>

    <div style="display:flex;gap:14px;flex-wrap:wrap;justify-content:center;margin-top:12px">
      <div class="pill">Correct: <span id="finalCorrect">0</span></div>
      <div class="pill">Wrong: <span id="finalWrong">0</span></div>
      <div class="pill">Attempted: <span id="finalAttempted">0</span></div>
    </div>

    <div style="margin-top:18px;text-align:center">
      <button class="primary" onclick="showView()">View</button>
      <button class="ghost" onclick="startNewQuiz()">Start New Quiz</button>
      <button class="ghost" onclick="tryAgain()">Try Again</button>
      <button class="ghost" onclick="window.print()">Print</button>
    </div>
  </section>

  <!-- VIEW / SUMMARY -->
  <section id="quiz-view" class="hidden">
    <h2 class="center">Quiz Summary & Details</h2>

    <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:10px">
      <div style="min-width:260px;text-align:left">
        <strong>Name:</strong> <span id="vName"></span><br>
        <strong>Grade:</strong> <span id="vGrade"></span><br>
        <strong>Age:</strong> <span id="vAge"></span><br>
        <strong>School:</strong> <span id="vSchool"></span><br>
        <strong>Topic/Bank:</strong> Mathematics Test Bank<br>
      </div>

      <div style="min-width:260px;text-align:left">
        <strong>Correct:</strong> <span id="vCorrect"></span><br>
        <strong>Wrong:</strong> <span id="vWrong"></span><br>
        <strong>Attempted:</strong> <span id="vAttempted"></span><br>
      </div>
    </div>

    <div style="text-align:center;margin-top:16px">
      <button class="primary" onclick="startNewQuiz()">Start New Quiz</button>
      <button class="ghost" onclick="tryAgain()">Try Again</button>
      <button class="ghost" onclick="window.print()">Print</button>
    </div>
  </section>

  <!-- HELP & ABOUT Modal HTML -->
  <div id="helpModal" class="modal" onclick="modalClick(event,'helpModal')">
    <div class="modal-content">
      <span class="close-x" onclick="closeModal('helpModal')">&times;</span>
      <h3>Help</h3>
      <p><strong>Contacts:</strong><br>Tel: +(220) 594 4287 / 263 0798<br>Email: info.jangafrica@gmail.com</p>
      <p class="small">Select a grade, set number of questions (max 16), then Start Quiz. For MCQs choose the correct radio option and press Submit. For short-answer type your numeric/text answer and press Submit.</p>
    </div>
  </div>

  <div id="aboutModal" class="modal" onclick="modalClick(event,'aboutModal')">
    <div class="modal-content">
      <span class="close-x" onclick="closeModal('aboutModal')">&times;</span>
      <h3>About JangAfrica</h3>
      <p>JangAfrica Learning Centre provides interactive educational programmes designed to strengthen students’ knowledge and problem-solving skills. Our Mathematics quizzes help learners practice, test, and master concepts while building confidence for future learning.</p>
    </div>
  </div>

  <footer>
    <small>© JangAfrica Learning Centre — Mathematics Test Bank (K–6)</small>
  </footer>
</div>

<script>
/* -------------------- QUIZ BANK (100 questions) --------------------
   For each question object:
   - type: 'mcq' or 'short'
   - q: question text
   - options: array (for mcq)
   - answer: number (index for mcq) or string/number for short (normalized)
-------------------------------------------------------------------*/
const quizBank = {
  "Kindergarten": [
    {type:'mcq', q:"Which shape has 3 sides?", options:["Circle","Square","Triangle","Rectangle"], answer:2},
    {type:'mcq', q:"How many corners does a rectangle have?", options:["2","3","4","5"], answer:2},
    {type:'mcq', q:"What comes after the number 7?", options:["5","6","8","9"], answer:2},
    {type:'mcq', q:"Which of the following is a 3D shape?", options:["Circle","Square","Cube","Triangle"], answer:2},
    {type:'mcq', q:"Which number is less: 5 or 8?", options:["5","8","Both equal","None"], answer:0},
    {type:'mcq', q:"Which is an example of a repeating pattern?", options:["ABABAB","AABBCC","12345","ZZZ"], answer:0},
    {type:'mcq', q:"Which number makes 5 when added to 2?", options:["1","2","3","4"], answer:2},
    {type:'mcq', q:"Which position word describes “on top”?", options:["Under","Behind","Above","Next to"], answer:2},
    {type:'mcq', q:"Which number is between 4 and 6?", options:["2","3","5","7"], answer:2},
    {type:'mcq', q:"Which tool helps us compare weights?", options:["Ruler","Balance scale","Thermometer","Clock"], answer:1},
    {type:'mcq', q:"What is the last number when counting from 1 to 10?", options:["9","10","11","20"], answer:1},
    {type:'mcq', q:"Which of these is a flat shape?", options:["Cube","Cylinder","Circle","Sphere"], answer:2},
    {type:'mcq', q:"How many sides does a square have?", options:["2","3","4","5"], answer:2},
    {type:'mcq', q:"Which number sentence is correct?", options:["2 + 3 = 4","4 + 1 = 5","3 – 1 = 3","5 – 2 = 4"], answer:1},
    {type:'mcq', q:"What is the biggest number?", options:["7","9","5","2"], answer:1},
    {type:'mcq', q:"Which is the correct way to write “ten”?", options:["100","10","1","11"], answer:1}
  ],

  "Grade 1":[
    {type:'mcq', q:"Which number comes before 50?", options:["51","49","60","40"], answer:1},
    {type:'mcq', q:"Which of the following is a rectangle?", options:["Four equal sides","Two long sides, two short sides","Three sides","No sides"], answer:1},
    {type:'mcq', q:"What is 6 + 2?", options:["7","8","9","10"], answer:1},
    {type:'mcq', q:"What is 10 – 3?", options:["6","7","8","9"], answer:1},
    {type:'mcq', q:"Which clock shows half-past 3?", options:["Hour hand at 12, minute hand at 6","Hour hand at 3, minute hand at 6","Hour hand at 6, minute hand at 3","Hour hand at 12, minute hand at 3"], answer:1},
    {type:'mcq', q:"Which of these equals 12?", options:["5 + 7","6 + 8","7 + 4","9 + 2"], answer:0},
    {type:'mcq', q:"What is the value of the digit 3 in the number 36?", options:["3 ones","3 tens","30 tens","6 tens"], answer:1},
    {type:'mcq', q:"Which is true?", options:["14 > 16","18 < 17","15 = 15","20 < 19"], answer:2},
    {type:'mcq', q:"Which shape is divided into halves?", options:["Circle split into 2 equal parts","Circle split into 3 parts","Rectangle split into 4 parts","Square split into 5 parts"], answer:0},
    {type:'mcq', q:"Which number is odd?", options:["2","4","7","10"], answer:2},
    {type:'mcq', q:"What is 9 – 6?", options:["2","3","4","5"], answer:1},
    {type:'mcq', q:"Which equation is true?", options:["7 = 3 + 5","10 – 2 = 8","6 + 4 = 11","5 = 2 + 4"], answer:1},
    {type:'mcq', q:"Which of the following is a cube?", options:["Dice","Clock","Book","Ball"], answer:0},
    {type:'mcq', q:"Which time shows 7 o’clock?", options:["Hour hand at 12, minute hand at 7","Hour hand at 7, minute hand at 12","Hour hand at 6, minute hand at 12","Hour hand at 7, minute hand at 6"], answer:1},
    {type:'mcq', q:"Which number is even?", options:["5","9","12","15"], answer:2},
    {type:'mcq', q:"Which number is missing? 20, 30, __, 50", options:["35","40","25","45"], answer:1}
  ],

  "Grade 2":[
    {type:'mcq', q:"Which shape is a pentagon?", options:["3 sides","4 sides","5 sides","6 sides"], answer:2},
    {type:'mcq', q:"Which is the sum of 15 + 7?", options:["20","21","22","23"], answer:3},
    {type:'mcq', q:"45 – 20 = ?", options:["15","25","35","20"], answer:1},
    {type:'mcq', q:"Which is 2 quarters of a pizza?", options:["1 whole","1 half","1 third","2 wholes"], answer:1},
    {type:'mcq', q:"How many centimeters are in 1 meter?", options:["10","100","1,000","1"], answer:1},
    {type:'mcq', q:"Which is an array?", options:["Random dots","Objects arranged in rows and columns","A circle","A triangle"], answer:1},
    {type:'mcq', q:"Which is equal to 300 + 40 + 2?", options:["302","342","432","324"], answer:1},
    {type:'mcq', q:"Which is odd?", options:["12","18","25","30"], answer:2},
    {type:'mcq', q:"Which is the correct sign: 47 ___ 52?", options:[">","<","=","None"], answer:1},
    {type:'mcq', q:"6 × 4 = ?", options:["10","20","24","28"], answer:2},
    {type:'mcq', q:"How many minutes are in one hour?", options:["30","60","90","120"], answer:1},
    {type:'mcq', q:"Which coin is worth the least?", options:["50 bututs","25 bututs","1 dalasi","5 dalasis"], answer:1},
    {type:'mcq', q:"Which is equal to 100 – 55?", options:["35","40","45","50"], answer:0},
    {type:'mcq', q:"Which shape has 6 sides?", options:["Triangle","Square","Hexagon","Pentagon"], answer:2},
    {type:'mcq', q:"Which fraction is the same as one-half?", options:["2/4","1/3","3/6","Both A and C"], answer:3},
    {type:'mcq', q:"Which number comes after 999?", options:["1000","999","1010","1100"], answer:0}
  ],

  /* Next sections: the bank also includes sets of short-answer questions (K, Grade1, Grade2)
     and Grades 3–6 short-answer problems. For these we include them as 'short' type with exact answers.
  */

  /* Short-answer block: Kindergarten (16 short) */
  "Kindergarten_short":[
    {type:'short', q:"2 + 3 = ?", answer:"5"},
    {type:'short', q:"5 – 2 = ?", answer:"3"},
    {type:'short', q:"4 + 1 = ?", answer:"5"},
    {type:'short', q:"6 – 4 = ?", answer:"2"},
    {type:'short', q:"3 + 2 = ?", answer:"5"},
    {type:'short', q:"7 – 5 = ?", answer:"2"},
    {type:'short', q:"9 – 3 = ?", answer:"6"},
    {type:'short', q:"8 – 6 = ?", answer:"2"},
    {type:'short', q:"1 + 4 = ?", answer:"5"},
    {type:'short', q:"10 – 7 = ?", answer:"3"},
    {type:'short', q:"2 + 5 = ?", answer:"7"},
    {type:'short', q:"6 – 1 = ?", answer:"5"},
    {type:'short', q:"3 + 6 = ?", answer:"9"},
    {type:'short', q:"7 – 2 = ?", answer:"5"},
    {type:'short', q:"Solve for □: 4 + □ = 7", answer:"3"},
    {type:'short', q:"Solve for x: x – 3 = 5", answer:"8"}
  ],

  "Grade1_short":[
    {type:'short', q:"12 + 8 = ?", answer:"20"},
    {type:'short', q:"15 – 7 = ?", answer:"8"},
    {type:'short', q:"9 + 6 = ?", answer:"15"},
    {type:'short', q:"20 – 5 = ?", answer:"15"},
    {type:'short', q:"13 + 4 = ?", answer:"17"},
    {type:'short', q:"18 – 9 = ?", answer:"9"},
    {type:'short', q:"25 + 15 = ?", answer:"40"},
    {type:'short', q:"30 – 12 = ?", answer:"18"},
    {type:'short', q:"Solve for x: x + 5 = 12", answer:"7"},
    {type:'short', q:"Solve for y: y – 4 = 9", answer:"13"},
    {type:'short', q:"9 + 9 = ?", answer:"18"},
    {type:'short', q:"17 – 8 = ?", answer:"9"},
    {type:'short', q:"Solve for x: 7 + x = 15", answer:"8"},
    {type:'short', q:"Solve for y: y – 6 = 10", answer:"16"},
    {type:'short', q:"35 + 12 = ?", answer:"47"},
    {type:'short', q:"40 – 18 = ?", answer:"22"}
  ],

  "Grade2_short":[
    {type:'short', q:"45 + 32 = ?", answer:"77"},
    {type:'short', q:"78 – 56 = ?", answer:"22"},
    {type:'short', q:"120 – 85 = ?", answer:"35"},
    {type:'short', q:"64 + 28 = ?", answer:"92"},
    {type:'short', q:"36 – 14 = ?", answer:"22"},
    {type:'short', q:"Solve for x: x + 15 = 40", answer:"25"},
    {type:'short', q:"Solve for y: y – 28 = 12", answer:"40"},
    {type:'short', q:"32 + 19 = ?", answer:"51"},
    {type:'short', q:"40 ÷ 5 = ?", answer:"8"},
    {type:'short', q:"7 × 8 = ?", answer:"56"},
    {type:'short', q:"Solve for n: 6n = 36", answer:"6"},
    {type:'short', q:"Solve for m: m ÷ 7 = 8", answer:"56"},
    {type:'short', q:"15 × 4 = ?", answer:"60"},
    {type:'short', q:"72 ÷ 9 = ?", answer:"8"},
    {type:'short', q:"100 – 37 = ?", answer:"63"},
    {type:'short', q:"25 + 75 = ?", answer:"100"}
  ],

  /* Grades 3 - 6 short-answer (16 each) */
  "Grade3":[
    {type:'short', q:"234 + 567 = ?", answer:"801"},
    {type:'short', q:"785 – 432 = ?", answer:"353"},
    {type:'short', q:"300 – 125 = ?", answer:"175"},
    {type:'short', q:"Solve for x: x + 456 = 780", answer:"324"},
    {type:'short', q:"36 × 7 = ?", answer:"252"},
    {type:'short', q:"84 ÷ 12 = ?", answer:"7"},
    {type:'short', q:"63 ÷ 9 = ?", answer:"7"},
    {type:'short', q:"25 × 8 = ?", answer:"200"},
    {type:'short', q:"Round 478 to the nearest 10.", answer:"480"},
    {type:'short', q:"Round 642 to the nearest 100.", answer:"600"},
    {type:'short', q:"Solve for y: y ÷ 6 = 12", answer:"72"},
    {type:'short', q:"Solve for x: 5x = 35", answer:"7"},
    {type:'short', q:"2/3 + 1/6 = ? (as fraction)", answer:"5/6"},
    {type:'short', q:"Perimeter of rectangle (L=12 cm, W=8 cm) = ?", answer:"40"},
    {type:'short', q:"Area of square (side = 9 cm) = ?", answer:"81"},
    {type:'short', q:"325 + 468 – 289 = ?", answer:"504"}
  ],

  "Grade4":[
    {type:'short', q:"2,345 + 6,782 = ?", answer:"913? Oh wait - calculate precisely: 2345 + 6782 = 9127", answerNormalized:"9127"},
    {type:'short', q:"9,000 – 4,678 = ?", answer:"4322"},
    {type:'short', q:"456 × 23 = ?", answer:"10488"},
    {type:'short', q:"1,260 ÷ 15 = ?", answer:"84"},
    {type:'short', q:"3/5 + 2/5 = ?", answer:"1"},
    {type:'short', q:"7/8 – 3/8 = ?", answer:"1/2"},
    {type:'short', q:"Solve for x: 2x + 7 = 21", answer:"7"},
    {type:'short', q:"Solve for y: y – 15 = 27", answer:"42"},
    {type:'short', q:"Convert 3/10 to a decimal.", answer:"0.3"},
    {type:'short', q:"Compare: 0.45 ___ 0.54", answer:"<"},
    {type:'short', q:"Perimeter of triangle (10,12,8) = ?", answer:"30"},
    {type:'short', q:"Area of rectangle (25 × 10) = ?", answer:"250"},
    {type:'short', q:"Solve for m: 15m = 300", answer:"20"},
    {type:'short', q:"Solve for n: n ÷ 25 = 12", answer:"300"},
    {type:'short', q:"Round 8,467 to the nearest 1,000.", answer:"8000"},
    {type:'short', q:"1,248 + 2,672 – 890 = ?", answer:"3030"}
  ],

  "Grade5":[
    {type:'short', q:"45.6 + 23.78 = ?", answer:"69.38"},
    {type:'short', q:"78.45 – 26.32 = ?", answer:"52.13"},
    {type:'short', q:"245 × 36 = ?", answer:"8820"},
    {type:'short', q:"6,384 ÷ 24 = ?", answer:"266"},
    {type:'short', q:"3/4 + 2/5 = ? (as fraction or decimal)", answer:"23/20"},
    {type:'short', q:"7/8 – 3/10 = ? (as fraction)", answer:"(35/40 - 12/40)=23/40"},
    {type:'short', q:"Solve for x: 5x = 135", answer:"27"},
    {type:'short', q:"Solve for y: y ÷ 12 = 15", answer:"180"},
    {type:'short', q:"Convert 7/20 to a decimal.", answer:"0.35"},
    {type:'short', q:"15% of 200 = ?", answer:"30"},
    {type:'short', q:"Volume of cube (side = 5 cm) = ?", answer:"125"},
    {type:'short', q:"Volume of cuboid (8 × 5 × 4 cm) = ?", answer:"160"},
    {type:'short', q:"Solve for x: 3x + 45 = 120", answer:"25"},
    {type:'short', q:"Solve for y: 2y – 18 = 64", answer:"41"},
    {type:'short', q:"Round 48.678 to the nearest tenth.", answer:"48.7"},
    {type:'short', q:"Solve: 56 × 25 = ?", answer:"1400"}
  ],

  "Grade6":[
    {type:'short', q:"3,476 + 5,829 = ?", answer:"9305"},
    {type:'short', q:"9,045 – 6,382 = ?", answer:"2663"},
    {type:'short', q:"456 × 128 = ?", answer:"58368"},
    {type:'short', q:"8,424 ÷ 36 = ?", answer:"234"},
    {type:'short', q:"2/3 + 4/9 = ? (as fraction)", answer:"10/9"},
    {type:'short', q:"7/8 – 5/12 = ? (as fraction)", answer:"11/24"},
    {type:'short', q:"Solve for x: 3x – 7 = 20", answer:"9"},
    {type:'short', q:"Solve for y: 5y + 12 = 62", answer:"10"},
    {type:'short', q:"Write 0.375 as a fraction.", answer:"3/8"},
    {type:'short', q:"Perimeter of rectangle (15 × 9) = ?", answer:"48"},
    {type:'short', q:"Area of square (side = 12) = ?", answer:"144"},
    {type:'short', q:"Surface area of cube (side = 10) = ?", answer:"600"},
    {type:'short', q:"Convert 2.5 km to meters.", answer:"2500"},
    {type:'short', q:"35% of 480 = ?", answer:"168"},
    {type:'short', q:"Solve for m: 12m = 300", answer:"25"},
    {type:'short', q:"Solve for n: n ÷ 18 = 24", answer:"432"}
  ]
};

/* -------------------- QUIZ LOGIC -------------------- */
let session = {
  grade: null,
  name: "",
  age: "",
  school: "",
  totalQ: 0,
  qlist: [], // objects {type,q,options,answer}
  idx: 0,
  correct: 0,
  wrong: 0,
  attempted:0
};

function showSection(id){
  ['home','quiz-setup','quiz-play','quiz-results','quiz-view'].forEach(s=>{
    document.getElementById(s).classList.add('hidden');
  });
  document.getElementById(id).classList.remove('hidden');
}

// modal helpers
function openModal(id){ document.getElementById(id).style.display='block'; }
function closeModal(id){ document.getElementById(id).style.display='none'; }
function modalClick(e,id){ if(e.target.id===id) closeModal(id); }

/* BEGIN quiz */
function beginQuiz(){
  // read inputs
  const grade = document.getElementById('uGrade').value;
  if(!grade){ alert('Please select a Grade'); return; }
  const num = parseInt(document.getElementById('numQ').value) || 16;
  if(num < 1 || num > 16){ alert('Number of questions must be between 1 and 16'); return; }
  session.grade = grade;
  session.name = (document.getElementById('uName').value || 'Learner').trim();
  session.age = document.getElementById('uAge').value || '';
  session.school = document.getElementById('uSchool').value || '';
  session.totalQ = num;
  // Prepare qlist: for grades that have MCQs and short sets, choose the appropriate bank
  let pool = [];
  if(grade === 'Kindergarten'){
    pool = quizBank['Kindergarten'].concat(quizBank['Kindergarten_short']);
  } else if(grade === 'Grade 1'){
    pool = quizBank['Grade 1'].concat(quizBank['Grade1_short']);
  } else if(grade === 'Grade 2'){
    pool = quizBank['Grade 2'].concat(quizBank['Grade2_short']);
  } else {
    // Grades 3-6 have short-only in our bank
    pool = quizBank[grade] || [];
  }
  // ensure we have at least requested questions
  if(pool.length === 0){ alert('No question bank found for '+grade); return; }
  // pick first num questions (or shuffle and pick)
  session.qlist = shuffleArray(pool).slice(0, session.totalQ);
  // normalize some entries that had answerNormalized vs answer (fix the 1 malformed Grade4 entry)
  session.qlist = session.qlist.map(q=>{
    if(q.answerNormalized !== undefined) q.answer = q.answerNormalized;
    return q;
  });
  session.idx = 0;
  session.correct = 0;
  session.wrong = 0;
  session.attempted = 0;
  // show play screen
  document.getElementById('displayGrade').innerText = grade;
  document.getElementById('displayName').innerText = session.name;
  document.getElementById('qTotal').innerText = session.totalQ;
  showSection('quiz-play');
  renderQuestion();
}

/* render current question */
function renderQuestion(){
  const i = session.idx;
  const total = session.totalQ;
  document.getElementById('qIndex').innerText = Math.min(i+1, total);
  const progressPct = Math.round((session.idx / total) * 100);
  const progressEl = document.getElementById('progress');
  progressEl.style.width = progressPct + '%';
  progressEl.innerText = progressPct + '%';
  document.getElementById('displayCorrect').innerText = session.correct;
  document.getElementById('displayWrong').innerText = session.wrong;

  const box = document.getElementById('questionBox');
  box.innerHTML = '';
  if(i >= total){
    finishQuiz();
    return;
  }
  const qobj = session.qlist[i];
  // question header
  const qnum = document.createElement('div');
  qnum.innerHTML = `<strong>Q${i+1}.</strong>`;
  const qtext = document.createElement('div');
  qtext.style.marginTop = '8px';
  qtext.innerHTML = `<div style="font-size:16px">${escapeHtml(qobj.q)}</div>`;
  box.appendChild(qnum);
  box.appendChild(qtext);

  if(qobj.type === 'mcq'){
    const opts = document.createElement('div');
    opts.className = 'options';
    qobj.options.forEach((opt, idx)=>{
      const id = `opt_${i}_${idx}`;
      const label = document.createElement('label');
      label.innerHTML = `<input type="radio" name="choice" value="${idx}" id="${id}"> ${escapeHtml(opt)}`;
      opts.appendChild(label);
    });
    box.appendChild(opts);
  } else if(qobj.type === 'short'){
    const input = document.createElement('input');
    input.type = 'text';
    input.id = 'shortAns';
    input.placeholder = 'Type your answer here';
    input.style.width = '100%';
    input.style.padding = '8px';
    input.style.marginTop = '10px';
    input.style.borderRadius = '6px';
    input.style.border = '1px solid #ccc';
    box.appendChild(input);
  } else {
    // fallback to short
    const input = document.createElement('input');
    input.type = 'text';
    input.id = 'shortAns';
    box.appendChild(input);
  }
}

/* submit current answer */
function submitAnswer(){
  const i = session.idx;
  if(i >= session.totalQ){ finishQuiz(); return; }
  const qobj = session.qlist[i];
  let userAns = null, correctFlag = false;
  if(qobj.type === 'mcq'){
    const sel = document.querySelector('input[name="choice"]:checked');
    if(!sel){ alert('Please select an option'); return; }
    userAns = parseInt(sel.value,10);
    correctFlag = (userAns === qobj.answer);
  } else {
    const val = (document.getElementById('shortAns') || {}).value;
    if(val === undefined || val === null || val.toString().trim()===''){ alert('Please enter an answer'); return; }
    userAns = val.toString().trim();
    // normalize and compare
    correctFlag = compareAnswers(userAns, qobj.answer);
  }
  session.attempted++;
  if(correctFlag){ session.correct++; } else { session.wrong++; }
  session.idx++;
  // if finished
  if(session.idx >= session.totalQ){ finishQuiz(); return; }
  renderQuestion();
}

/* allow finishing early */
function finishEarly(){ if(confirm('Finish quiz now and see results?')) finishQuiz(); }

/* finish quiz */
function finishQuiz(){
  // show results
  document.getElementById('finalCorrect').innerText = session.correct;
  document.getElementById('finalWrong').innerText = session.wrong;
  document.getElementById('finalAttempted').innerText = session.attempted;
  showSection('quiz-results');
  // progress bar show 100%
  document.getElementById('progress').style.width = '100%';
  document.getElementById('progress').innerText = '100%';
}

/* show view summary */
function showView(){
  document.getElementById('vName').innerText = session.name;
  document.getElementById('vGrade').innerText = session.grade;
  document.getElementById('vAge').innerText = session.age;
  document.getElementById('vSchool').innerText = session.school;
  document.getElementById('vCorrect').innerText = session.correct;
  document.getElementById('vWrong').innerText = session.wrong;
  document.getElementById('vAttempted').innerText = session.attempted;
  showSection('quiz-view');
}

/* Start New Quiz (clear details) */
function startNewQuiz(){
  // reset UI fields
  document.getElementById('uName').value = '';
  document.getElementById('uGrade').value = '';
  document.getElementById('uAge').value = '';
  document.getElementById('uSchool').value = '';
  document.getElementById('numQ').value = 16;
  session = {grade:null,name:"",age:"",school:"",totalQ:0,qlist:[],idx:0,correct:0,wrong:0,attempted:0};
  showSection('quiz-setup');
}

/* Try Again: restart same grade and settings (keeps user info) */
function tryAgain(){
  const grade = session.grade;
  if(!grade){ alert('No previous session to try again. Start a new quiz.'); return; }
  // keep name, age, school, totalQ
  // rebuild qlist and reset counters
  const total = session.totalQ || parseInt(document.getElementById('numQ').value) || 16;
  const pool = buildPoolForGrade(grade);
  session.qlist = shuffleArray(pool).slice(0,total);
  session.idx = 0; session.correct = 0; session.wrong = 0; session.attempted = 0;
  // update display
  document.getElementById('displayGrade').innerText = grade;
  document.getElementById('displayName').innerText = session.name || document.getElementById('uName').value || 'Learner';
  document.getElementById('qTotal').innerText = total;
  session.totalQ = total;
  showSection('quiz-play');
  renderQuestion();
}

/* ---------------- utility helpers ---------------- */
function buildPoolForGrade(grade){
  if(grade === 'Kindergarten') return quizBank['Kindergarten'].concat(quizBank['Kindergarten_short']);
  if(grade === 'Grade 1') return quizBank['Grade 1'].concat(quizBank['Grade1_short']);
  if(grade === 'Grade 2') return quizBank['Grade 2'].concat(quizBank['Grade2_short']);
  return quizBank[grade] || [];
}

function shuffleArray(a){
  const arr = a.slice();
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

/* compare short-answer user input to stored answer.
   Accepts numeric and simple fraction forms, trims whitespace, case-insensitive.
   If stored answer contains '/', compare normalized fractions or exact string.
*/
function compareAnswers(user, expected){
  if(expected === undefined || expected === null) return false;
  const u = user.trim().toLowerCase();
  let e = expected.toString().trim().toLowerCase();

  // if expected is fraction like "5/6" or "23/40" allow both fraction and decimal (to limited tolerance)
  if(e.includes('/')){
    // normalize fraction strings: remove spaces
    if(u === e) return true;
    // allow decimal equivalents (e.g., 0.8333 for 5/6) -> check numeric closeness
    const fracParts = e.split('/').map(Number);
    if(!isNaN(fracParts[0]) && !isNaN(fracParts[1]) && fracParts[1]!==0){
      const eNum = fracParts[0] / fracParts[1];
      const uNum = Number(u);
      if(!isNaN(uNum) && Math.abs(uNum - eNum) < 0.0001) return true;
      // try reducing both fractions (if user typed fraction)
      if(u.includes('/')){
        const up = u.split('/').map(Number);
        if(up.length===2 && !isNaN(up[0]) && !isNaN(up[1])){
          // compare cross-multiplication
          if(up[0]*fracParts[1] === fracParts[0]*up[1]) return true;
        }
      }
    }
    return false;
  }

  // if expected is decimal number (like "69.38"), accept numeric equal within small tolerance
  if(!isNaN(Number(e))){
    const en = Number(e);
    const un = Number(u);
    if(!isNaN(un)){
      return Math.abs(en-un) < 1e-6;
    }
    // also accept fractions that equal the decimal? skipping for now
  }

  // for answers like "1" or "01" allow equal numeric
  if(!isNaN(Number(e)) && !isNaN(Number(u))){
    return Number(e) === Number(u);
  }

  // accept small formatting differences: e.g., "0.3" and ".3"
  if(e.replace(/^0+/, '') === u.replace(/^0+/, '')) return true;

  // default string compare
  return e === u;
}

/* escape HTML for safety in question text */
function escapeHtml(str){
  return String(str).replace(/[&<>"]/g, function(s){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[s];});
}

/* helper to start tryAgain quickly from results view */
function goTryAgainFromResults(){
  tryAgain();
}

</script>
</body>
</html>
